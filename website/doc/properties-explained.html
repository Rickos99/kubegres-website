<gigo-include-in file="includes/doc-template.html" />

        <div class="contentsBox">
            <div class="contentsBoxHeader">All properties explained</div>
            <div class="contentsBoxBody">
                <article>
                    <p>
                        The "Kubegres" API types are available in
                        <a target="_blank" href="https://github.com/reactive-tech/kubegres/blob/main/api/v1/kubegres_types.go#L41">
                            GitHub</a>.
                    </p>
                    <p>
                        Kubegres uses predefined templates to create Kubernetes resources. Those templates are available in
                        <a target="_blank" href="https://github.com/reactive-tech/kubegres/tree/main/controllers/spec/template/yaml">
                            GitHub</a>.
                    </p>
                    <p>
                        Please see below a Kubegres resource YAML containing all available properties with example values,
                        followed by a table explaining the meaning of each property:
                        <pre>
apiVersion: kubegres.reactive-tech.io/v1
kind: Kubegres
metadata:
  name: mypostgres
  namespace: default
  annotations:
    imageregistry: "https://hub.docker.com/"
    nginx.ingress.kubernetes.io/affinity: cookie

spec:

   replicas: 3
   image: postgres:13.2
   port: 5432

   imagePullSecrets:
      - name: my-private-docker-repo-secret

   database:
      size: 200Mi
      storageClassName: standard
      volumeMount: /var/lib/postgresql/data

   customConfig: mypostgres-conf

   failover:
      isDisabled: false
      promotePod: "mypostgres-2-0"

   backup:
      schedule: "* */1 * * *"
      pvcName: my-backup-pvc
      volumeMount: /var/lib/backup

   resources:
      limits:
         memory: "4Gi"
         cpu: "1"
      requests:
         memory: "2Gi"
         cpu: "1"

   scheduler:
      affinity:
         podAntiAffinity:
            preferredDuringSchedulingIgnoredDuringExecution:
               - weight: 100
                 podAffinityTerm:
                    labelSelector:
                       matchExpressions:
                         - key: app
                           operator: In
                           values:
                           - postgres-name
                    topologyKey: "kubernetes.io/hostname"
      tolerations:
         - key: group
           operator: Equal
           value: critical

   env:
      - name: POSTGRES_PASSWORD
        valueFrom:
           secretKeyRef:
              name: mySecretResource
              key: superUserPassword

      - name: POSTGRES_REPLICATION_PASSWORD
        valueFrom:
           secretKeyRef:
              name: mySecretResource
              key: replicationUserPassword

                        </pre>
                    </p>

                    <p>
                        <table>
                            <tr>
                                <th>Property</th>
                                <th>If not set in YAML, default value</th>
                                <th>Meaning</th>
                            </tr>
                            <tr>
                                <td>name</td>
                                <td>&nbsp;</td>
                                <td>
                                    <b>Required.</b> <br/> The unique name of a Kubegres resource in Kubernetes.
                                    It defines the unique name of a PostgreSql cluster, which is "mypostgres" for this example.
                                    <br/>Kubegres operator allows creating as many clusters as a given infrastructure can handle
                                    as long as each cluster's name is unique.
                                </td>
                            </tr>
                            <tr>
                                <td>namespace</td>
                                <td>default</td>
                                <td>
                                    Optional. <br/>The namespace where the Kubegres resource will be created and
                                    a PostgreSql cluster will be deployed.
                                </td>
                            </tr>
                            <tr>
                                <td>annotations</td>
                                <td>&nbsp;</td>
                                <td>
                                    Optional. <br/>The annotations to pass to the created Pods and StatefulSets.
                                    We can set as many annotations as needed.
                                    <br/>As an example, in the YAML above we set the annotations:
                                    <br/>- imageregistry: "https://hub.docker.com/
                                    <br/>- nginx.ingress.kubernetes.io/affinity: cookie.
                                </td>
                            </tr>
                            <tr>
                                <td>spec<br/>&nbsp;replicas</td>
                                <td>&nbsp;</td>
                                <td><b>Required.</b> <br/> It defines the number of PostgreSql instances (or Pods) to deploy in a cluster.<br/>
                                    For example, if set to '3', Kubegres deploys 1 Primary Pod and 2 Replica Pods.
                                    If set to '1', it will only create 1 Primary Pod without creating any Replica Pods.</td>
                            </tr>
                            <tr>
                                <td>spec<br/>&nbsp;image</td>
                                <td>&nbsp;</td>
                                <td>
                                    <b>Required.</b> <br/> The name of the Postgres Docker image.
                                    Kubegres expects either a <a target="_blank" href="https://hub.docker.com/_/postgres">Postgres Docker official image</a> or any compatible image. <br/>
                                    Consequently, Kubegres operator does not ship with a custom Docker image with obscure set of libraries.<br/>
                                    More details about the Postgres docker image:
                                    <a target="_blank" href="https://hub.docker.com/_/postgres">Docker Hub</a>.
                                </td>
                            </tr>
                            <tr>
                                <td>spec<br/>&nbsp;imagePullSecrets</td>
                                <td>&nbsp;</td>
                                <td>
                                    Optional. <br/>
                                    It allows to pull custom Postgres images from a private repo.
                                    The images have to be compatible with a
                                    <a target="_blank" href="https://hub.docker.com/_/postgres">Postgres Docker official image</a>.
                                    <br/>
                                    More details about the
                                    <a target="_blank" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.21/#podspec-v1-core">
                                        type
                                    </a>
                                    of this field (search for "imagePullSecrets" in that page's table).
                                </td>
                            </tr>
                            <tr>
                                <td>spec<br/>&nbsp;port</td>
                                <td>5432</td>
                                <td>Optional. <br/>
                                    The port exposed by the Postgres docker container to access to the PostgreSql server.
                                </td>
                            </tr>
                            <tr>
                                <td>spec<br/>&nbsp;database<br/>&nbsp;&nbsp;size</td>
                                <td>&nbsp;</td>
                                <td><b>Required.</b> <br/> The size of each Postgres Pod's database in a cluster.
                                    We use "Mi" for Megabyte and "Gi" for Gigabyte.</td>
                            </tr>
                            <tr>
                                <td>spec<br/>&nbsp;database<br/>&nbsp;&nbsp;storageClassName</td>
                                <td>Uses the default Storage-Class defined in a Kubernetes cluster</td>
                                <td>
                                    Optional. <br/> It defines the Storage-Class which will be used to store
                                    PostgreSql database. <br/>
                                    If it is not set, Kubegres operator uses the default Storage-Class available in a Kubernetes cluster. <br/>
                                    Behind the scenes, Kubernetes creates a
                                    Persistence-Volume-Claim (PVC) for each Postgres Pod and associates it to the given Storage-Class name.<br/>
                                </td>
                            </tr>
                            <tr>
                                <td>spec<br/>&nbsp;database<br/>&nbsp;&nbsp;volumeMount</td>
                                <td>/var/lib/postgresql/data</td>
                                <td>Optional. <br/>
                                    It defines the path in the Postgres container where the database folder 'pgdata' is mounted.
                                    The mount will be physically located in the volume (PVC) backed by a Storage-Class
                                    (as defined in the above field 'database.storageClassName').
                                </td>
                            </tr>
                            <tr>
                                <td>spec<br/>&nbsp;customConfig</td>
                                <td>base-kubepostgres-config</td>
                                <td>
                                    Optional. <br/> It allows setting the name of a ConfigMap which contains the configs
                                    files and their contents required by Kubegres. <br/>
                                    <a href="/doc/override-default-configs.html">More details here</a>.
                                </td>
                            </tr>
                            <tr>
                                <td>spec<br/>&nbsp;failover<br/>&nbsp;&nbsp;isDisabled</td>
                                <td>false</td>
                                <td>
                                    Optional.<br/> It disables the automatic failover feature for a cluster of PostgreSql.<br/>
                                    If it is set to true and if a Primary or Replica PostgreSql instance is not available
                                    then Kubegres will not attempt to failover and fix the cluster. <br/>
                                    This option can be useful when manually maintaining a node (e.g. restarting it, patching it, ...)
                                    and we do not want Kubegres to automatically failover a Primary or Replica instances during
                                    that maintenance.
                                </td>
                            </tr>
                            <tr>
                                <td>spec<br/>&nbsp;failover<br/>&nbsp;&nbsp;promotePod</td>
                                <td>&nbsp;</td>
                                <td>
                                    Optional.<br/> It allows to manually promote a Replica PostgreSql Pod as a Primary Pod.<br/>
                                    It expects the name of a Replica Pod that we would like to promote as a Primary.<br/>
                                    This option is independent from the value of the above field "failover.isDisabled".
                                    It is always possible to manually promote a Pod, whether "failover.isDisabled" is set to true or to false.
                                </td>
                            </tr>
                            <tr>
                                <td>spec<br/>&nbsp;backup<br/>&nbsp;&nbsp;schedule</td>
                                <td>&nbsp;</td>
                                <td>
                                    Optional, unless if we want to enable backup. <br/> It schedules a back-up regularly.
                                    The cron format follows the standard
                                    <a target="_blank" href="https://en.wikipedia.org/wiki/Cron">Cron</a> spec. <br/>
                                    <a href="/doc/enable-backup.html">More details here</a>.
                                </td>
                            </tr>
                            <tr>
                                <td>spec<br/>&nbsp;backup<br/>&nbsp;&nbsp;pvcName</td>
                                <td>&nbsp;</td>
                                <td>
                                    Optional, unless if we want to enable backup. <br/> The Persistence-Volume-Claim (PVC)
                                    defining where the back-up data will be stored. A volume backed by a PVC is mounted
                                    into the path defined by "spec.backup.volumeMount" (see below). <br/>
                                    <a href="/doc/enable-backup.html">More details here</a>.
                                </td>
                            </tr>
                            <tr>
                                <td>spec<br/>&nbsp;backup<br/>&nbsp;&nbsp;volumeMount</td>
                                <td>&nbsp;</td>
                                <td>
                                    Optional, unless if we want to enable backup. <br/> The location where the backup is
                                    stored in the docker image. A volume is mounted on that path using the PVC name defined
                                    by "spec.database.pvcName". <br/> <a href="/doc/enable-backup.html">More details here</a>.
                                </td>
                            </tr>
                            <tr>
                                <td>spec<br/>&nbsp;resources</td>
                                <td>&nbsp;</td>
                                <td>
                                    Optional.<br/> It allows to define the resources requests/limits of CPU and Memory for the Postgres Pods.
                                    Its type is of the Kubernetes type
                                    <a target="_blank" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.21/#resourcerequirements-v1-core">
                                        ResourceRequirements
                                    </a>.
                                    <br/> <a target="_blank" href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/">
                                    More details here</a>.
                                </td>
                            </tr>
                            <tr>
                                <td>spec<br/>&nbsp;scheduler<br/>&nbsp;&nbsp;affinity</td>
                                <td>&nbsp;</td>
                                <td>
                                    Optional.<br/> It allows setting custom Pod/Node affinity policy.
                                    Its type is of the Kubernetes type
                                    <a target="_blank" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.21/#affinity-v1-core">
                                        Affinity
                                    </a>.
                                    <br/> <a target="_blank" href="https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#affinity-and-anti-affinity">
                                    More details here</a>.
                                </td>
                            </tr>
                            <tr>
                                <td>spec<br/>&nbsp;scheduler<br/>&nbsp;&nbsp;tolerations</td>
                                <td>&nbsp;</td>
                                <td>
                                    Optional.<br/> It allows setting custom tolerations policy.
                                    Its type is an array of the Kubernetes type
                                    <a target="_blank" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.21/#toleration-v1-core">
                                         Toleration
                                    </a>.
                                    <br/> <a target="_blank" href="https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/">
                                    More details here</a>.
                                </td>
                            </tr>
                            <tr>
                                <td>spec<br/>&nbsp;env<br/>&nbsp;&nbsp;name</td>
                                <td>&nbsp;</td>
                                <td>
                                    <b>Required.</b> <br/> The password of the super user "postgres". This user is created
                                    by the official PostgreSql docker image.
                                </td>
                            </tr>
                            <tr>
                                <td>spec<br/>&nbsp;env<br/>&nbsp;&nbsp;name</td>
                                <td>&nbsp;</td>
                                <td>
                                    <b>Required.</b> <br/> The password of the "replication" user which is used by PostgreSql
                                    to replicate data between Primary and Replicas servers.
                                </td>
                            </tr>
                        </table>
                    </p>

                    <div class="publicationDetails"><time datetime="2021-07-23" pubdate="pubdate">23 July 2021</time></div>

                </article>
            </div>
        </div>
